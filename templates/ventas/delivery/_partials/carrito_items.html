<!-- ventas/delivery/_partials/carrito_items.html -->
<div class="card-body p-0">
    {% if carrito_items %}
    <table class="table table-sm mb-0">
        <tbody>
            {% for item in carrito_items %}
            <tr>
                <td class="align-middle">
                    <strong>{{ item.nombre_base[:25] if item.nombre_base else item.nombre[:25] }}</strong>
                    {% if item.extras and item.extras|length > 0 %}
                    <br>
                    <small class="text-success">
                        {% for extra in item.extras %}
                        + {{ extra.valor }}{% if extra.precio_adicional > 0 %} (${{ extra.precio_adicional|format_price }}){% endif %}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </small>
                    {% endif %}
                    <br>
                    <small class="text-muted">${{ item.precio|format_price }} c/u</small>
                </td>
                <td class="align-middle text-center" style="width: 100px;">
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary"
                                hx-post="/delivery/actualizar_cantidad"
                                hx-vals='{"item_id": "{{ item.item_key|default(item.id) }}", "accion": "disminuir"}'
                                hx-target="#carrito-container"
                                hx-swap="innerHTML">‚àí</button>
                        <span class="btn btn-light disabled">{{ item.cantidad }}</span>
                        <button class="btn btn-outline-secondary"
                                hx-post="/delivery/actualizar_cantidad"
                                hx-vals='{"item_id": "{{ item.item_key|default(item.id) }}", "accion": "aumentar"}'
                                hx-target="#carrito-container"
                                hx-swap="innerHTML">+</button>
                    </div>
                </td>
                <td class="align-middle text-end" style="width: 80px;">
                    <strong>${{ item.subtotal|format_price }}</strong>
                </td>
                <td class="align-middle text-center" style="width: 40px;">
                    <button class="btn btn-sm btn-outline-danger"
                            hx-delete="/delivery/eliminar_del_carrito/{{ item.item_key|default(item.id) }}"
                            hx-target="#carrito-container"
                            hx-swap="innerHTML">üóëÔ∏è</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="text-center text-muted py-4">
        <p class="mb-0">üõí Carrito vac√≠o</p>
        <small>Haz clic en un producto para agregarlo</small>
    </div>
    {% endif %}
</div>

<!-- Resumen y bot√≥n de confirmar -->
<div class="card-footer">
    <div class="d-flex justify-content-between mb-2">
        <span>Subtotal:</span>
        <strong>${{ subtotal|format_price }}</strong>
    </div>
    <div class="d-flex justify-content-between mb-2">
        <span>Env√≠o:</span>
        <strong>${{ envio|format_price }}</strong>
    </div>
    <hr class="my-2">
    <div class="d-flex justify-content-between mb-3">
        <span class="h5 mb-0">Total:</span>
        <span class="h5 mb-0 text-primary">${{ total|format_price }}</span>
    </div>
    
    {% if carrito_items %}
    <button type="button" class="btn btn-success w-100"
            hx-post="/delivery/finalizar_pedido"
            hx-target="#right_panel"
            hx-swap="innerHTML">
        ‚úì Confirmar Pedido
    </button>
    {% else %}
    <button class="btn btn-secondary w-100" disabled>
        Agrega productos para continuar
    </button>
    {% endif %}
</div>